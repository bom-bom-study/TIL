# 토비의 스프링 3.1 Vol.1.pdf 

## 4장 : 예외 (JdbcTemplate을 대표로 하는 에외처리와 관련된 접근 방법)
- 예외처리의 원칙 : 모든 예외는 적절하게 복구되거나, 작업을 중단시키고 개발자에게 통보돼야 한다.

### 예외의 종류와 특징
#### 체크 예외(checked exception) : 명시적인 처리가 필요한 예외 를 다루는 방법

#### 자바에서 Throw를 통해 발생시킬 수 있는 예외 3 가지
- Error : java.lang.Error의 서브클래스들. 자바 VM에서 발생되므로, 애플리케이션 코드에서 잡아지지 않음 (OutOfMemoryError, ThreadDeath)
- Exception 체크 예외 : 애플리케이션 코드의 예외상황. 
    - 체크 예외 : Exception 클래스의 서브클래스. RuntimeException 상속 X한 클래스
    - 언체크 예외 : RuntimeException 상속한 클래스
- RuntimeException 언체크/런타임 예외 : 프로그램의 오류가 있을 때 발생. 오브젝트를 할당하지 않은 레퍼런스 변수를 사용하려고 시도했을 때 발생하는 NullPointerException, 허용되지 않는 값을 사용해서 메소드를 호출할 때 발생하는 IllegalArgumentException.
런타임예외는 개발자가 부주의해서 발생하는 예외이다! 즉 코드로 미리 조건을 체크한다면 피할 수 있다.

### 일반적인 예외처리 방법
- 예외 복구 : 예외상황을 파악하고 문제를 해결해서 정상 상태로 돌려놓는 것
- 예외처리 회피 : 예외처리를 자신이 담당하지 않고, 자신을 호출한 쪽으로 던지는 것
- 예외 전환 : 발생한 예외를 메소드 밖으로 던지되, 적절한 예외로 전환하여 던지는 것

### 예외 처리 전략
<런타인 예외 중심 전략 : 낙관적>
1. 되도록이면 런타임 에러로 던진다
- 자바 엔터프라이즈 서버환경에서 에러 발생시 작업을 일시 중지하고 사용자와 바로 커뮤니케이션하면서 에외상황을 복구할 수 없다. 어차피 체크에러로 던져도 대응할 수 없기 때문에, 빨리 런타임 에러로 전환해서 던지는 것이 낫다.

2. 어디에서든 처리할 수 있는 체크예외라면 (예를들어, DuplicatedUserIdException) 굳이 체크예외로 만들지말고, 런타임 예외로 만든다. 대신 add()메소드는 명시적으로 DuplicatedUserIdException을 던진다고 선언해야 한다.

<애플리케이션 예외 : 비관적>
- 애플리케이션 자체의 로직에 의해 발생되고, 반드시 catch를 통해 무언가 조치를 취하는 예외
- 은행업무의 잔고부족과 같이 반드시 처리해야하는 예외 상황에 쓰임
- 예외 발생가능한 코드를 try 블록 안에 모아놓고, 예외상황에 대한 처리는 catch블록에 모아두면 깔끔!
    
##### JdbcTemplate 적용후에는 SQLException이 코드에서 사라진다!
- 일단, 대부분의 SQLException은 복구가 불가능하다.
- 때문에 기계적인 체크예외인 throws선언을 쓰기보다는, 언체크/런타임 예외로 전환해주는게 좋다.
- JdbcTemplate템플릿과 콜백안에서 발생하는 모든 SQLException을 런타임 예외인 DataAccessExcepion으로 포장해서 던져준다 
-> JdbcTemplate을 사용하는 UserDao 메소드에서는 꼭 필요한 경우만 처리하고, 그 외에는 무시한다! -> SQLException이 모두 사라졌다!

### JDBC의 한계
- 각기 다른 DB들에 모두 범용되는 코드를 보장할 수 없다.
    - 각각의 DB별 비표준 SQL -> DAO를 DB별로 만들거나, SQL을 외부에서 독립시킨다. (7장)
    - 각각의 DB별 다양한 SQLException -> DB 상태를 담은 SQL 상태정보를 제공.

=> 이를 해결하기 위해, 드라이버나 DB 메타정보를 참고하여 DB종류를 확인하고, 매핑정보를 참고해서 적절한 예외클래스를 선택해준다. 때문에 DB가 달라져도 같은 종류의 에러라면 동일한 예외를 받을 수 있다.

##### DataAccessException : JDBC외의 자바 데이터 액세스 기술에서 발생하는 예외에도 적용됨. 스프링은 자바의 다양한 대에터 액세스 기술을 사용할 때 발생하는 예외들을 추상화해서 DataAccessException 계층구조 안에 정리해놓았다.